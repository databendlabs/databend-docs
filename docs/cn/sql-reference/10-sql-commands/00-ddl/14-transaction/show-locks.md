---
title: SHOW LOCKS
---
import FunctionDescription from '@site/src/components/FunctionDescription';

<FunctionDescription description="引入或更新于：v1.2.262"/>

提供当前持有表锁的活动事务列表，可以是当前用户在所有会话中的事务，也可以是Databend系统中所有用户的事务。锁是一种同步机制，用于限制对共享资源（如表）的访问，确保Databend系统中进程或线程之间的有序和受控交互，以维护数据一致性并防止冲突。

诸如[UPDATE](../../10-dml/dml-update.md)、[DELETE](../../10-dml/dml-delete-from.md)、[OPTIMIZE TABLE](../01-table/60-optimize-table.md)、[RECLUSTER TABLE](../06-clusterkey/dml-recluster-table.md)和[ALTER TABLE COLUMN](../01-table/90-alter-table-column.md)等操作可能会导致系统中的表锁。表锁功能默认启用。在资源冲突的情况下，您可以使用此命令检查具体细节。要禁用此功能，请执行`set enable_table_lock=0;`。

## 语法

```sql
SHOW LOCKS [IN ACCOUNT] [WHERE <expr>]
```

| 参数       | 描述                                                                                                                                         |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| IN ACCOUNT | 显示Databend系统中所有用户的锁信息。如果省略，则返回当前用户在所有会话中的锁。 |
| WHERE      | 根据状态过滤锁；有效值包括`HOLDING`和`WAITING`。                                                                    |

## 输出

该命令返回一个包含以下列的锁信息表：

| 列名        | 描述                                                                                                                                                                                                             |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| table_id    | 与锁关联的表的内部ID。                                                                                                                                                                     |
| revision    | 表示启动锁的事务版本的修订号。从0开始，每次后续事务都会增加此数字，从而在所有事务之间建立全面的顺序。 |
| type        | 锁的类型，例如`TABLE`。                                                                                                                                                                                      |
| status      | 锁的状态，例如`HOLDING`或`WAITING`。                                                                                                                                                                 |
| user        | 与锁关联的用户。                                                                                                                                                                                      |
| node        | 持有锁的查询节点的标识符。                                                                                                                                                                    |
| query_id    | 与锁相关的查询会话ID。在死锁或锁持有时间过长的情况下，可以使用它来[KILL](/sql/sql-commands/administration-cmds/kill)查询。                                                  |
| created_on  | 启动锁的事务创建时的时间戳。                                                                                                                                                     |
| acquired_on | 锁被获取时的时间戳。                                                                                                                                                                                   |
| extra_info  | 与锁相关的附加信息（如果有）。                                                                                                                                                                     |

## 示例

```sql
SHOW LOCKS IN ACCOUNT;
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
| table_id | revision | type  | status  | user | node                   | query_id                             | created_on                 | acquired_on                | extra_info |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
|       57 |     4517 | TABLE | HOLDING | root | xzi6pRbLUYasuA9QFB36m6 | d7989971-d5ec-4764-8e37-afe38ebc13e2 | 2023-12-13 09:56:47.295684 | 2023-12-13 09:56:47.310805 |            |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+

SHOW LOCKS;
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
| table_id | revision | type  | status  | user | node                   | query_id                             | created_on                 | acquired_on                | extra_info |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
|       57 |     4517 | TABLE | HOLDING | root | xzi6pRbLUYasuA9QFB36m6 | d7989971-d5ec-4764-8e37-afe38ebc13e2 | 2023-12-13 09:56:47.295684 | 2023-12-13 09:56:47.310805 |            |
|       57 |     4521 | TABLE | WAITING | zzq  | xzi6pRbLUYasuA9QFB36m6 | 4bc78044-d4fc-4fe1-a5c5-ff6ab1e3e372 | 2023-12-13 09:56:48.419774 | NULL                       |            |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+

SHOW LOCKS WHERE STATUS = 'HOLDING';
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
| table_id | revision | type  | status  | user | node                   | query_id                             | created_on                 | acquired_on                | extra_info |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
|       57 |     4517 | TABLE | HOLDING | root | xzi6pRbLUYasuA9QFB36m6 | d7989971-d5ec-4764-8e37-afe38ebc13e2 | 2023-12-13 09:56:47.295684 | 2023-12-13 09:56:47.310805 |            |
+----------+----------+-------+---------+------+------------------------+--------------------------------------+----------------------------+----------------------------+------------+
```