---
title: ANALYZE TABLE
sidebar_position: 7
---

计算表的各种统计信息。此命令在执行后*不会*显示结果。要显示结果，请使用函数 [FUSE_STATISTIC](../../../20-sql-functions/16-system-functions/fuse_statistic.md)。

Databend将每个表的统计数据保存为以UUID（32个字符的十六进制小写字符串）命名的JSON文件，并将这些文件存储在对象存储的路径 `<bucket_name>/[root]/<db_id>/<table_id>/` 中。

## 语法

```sql
ANALYZE TABLE [ <database_name>. ]<table_name>
```

- 该命令不通过比较来识别不同的值，而是通过计算存储段和块的数量来实现。这可能导致估计结果与实际值之间存在显著差异，例如，多个块持有相同的值。在这种情况下，Databend建议在运行估计之前尽可能合并存储段和块。
- 执行更新/删除/替换语句后，快照级别的列统计信息可能会放大。您可以通过执行分析语句来修正列统计信息。

## 示例

此示例估计表中每个列的不同值数量，并使用函数 [FUSE_STATISTIC](/sql/sql-functions/system-functions/fuse_statistic) 显示结果：

```sql
CREATE TABLE sample (
    user_id INT,
    name VARCHAR(50),
    age INT
);

INSERT INTO sample (user_id, name, age) VALUES
(1, 'Alice', 30),
(2, 'Bob', 25),
(3, 'Charlie', 35),
(4, 'Diana', 28),
(5, 'Eve', 28);

SET enable_analyze_histogram = 1;

-- 在运行 ANALYZE TABLE 进行估计之前，FUSE_STATISTIC 不会返回任何结果。
SELECT * FROM FUSE_STATISTIC('default', 'sample');

ANALYZE TABLE sample;

SELECT * FROM FUSE_STATISTIC('default', 'sample');

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ column_name │ distinct_count │                                                                                                                                                               histogram                                                                                                                                                              │
├─────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ age         │              4 │ [bucket id: 0, min: "25", max: "25", ndv: 1.0, count: 1.0], [bucket id: 1, min: "28", max: "28", ndv: 1.0, count: 1.0], [bucket id: 2, min: "28", max: "28", ndv: 1.0, count: 1.0], [bucket id: 3, min: "30", max: "30", ndv: 1.0, count: 1.0], [bucket id: 4, min: "35", max: "35", ndv: 1.0, count: 1.0]                           │
│ user_id     │              5 │ [bucket id: 0, min: "1", max: "1", ndv: 1.0, count: 1.0], [bucket id: 1, min: "2", max: "2", ndv: 1.0, count: 1.0], [bucket id: 2, min: "3", max: "3", ndv: 1.0, count: 1.0], [bucket id: 3, min: "4", max: "4", ndv: 1.0, count: 1.0], [bucket id: 4, min: "5", max: "5", ndv: 1.0, count: 1.0]                                     │
│ name        │              5 │ [bucket id: 0, min: "Alice", max: "Alice", ndv: 1.0, count: 1.0], [bucket id: 1, min: "Bob", max: "Bob", ndv: 1.0, count: 1.0], [bucket id: 2, min: "Charlie", max: "Charlie", ndv: 1.0, count: 1.0], [bucket id: 3, min: "Diana", max: "Diana", ndv: 1.0, count: 1.0], [bucket id: 4, min: "Eve", max: "Eve", ndv: 1.0, count: 1.0] │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

INSERT INTO sample (user_id, name, age) VALUES
(6, 'Frank', 40);

-- FUSE_STATISTIC 返回上次估计的结果。要获取最新的估计值，请再次运行 ANALYZE TABLE。
SELECT * FROM FUSE_STATISTIC('default', 'sample');

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ column_name │ distinct_count │                                                                                                                                                               histogram                                                                                                                                                              │
├─────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ age         │              4 │ [bucket id: 0, min: "25", max: "25", ndv: 1.0, count: 1.0], [bucket id: 1, min: "28", max: "28", ndv: 1.0, count: 1.0], [bucket id: 2, min: "28", max: "28", ndv: 1.0, count: 1.0], [bucket id: 3, min: "30", max: "30", ndv: 1.0, count: 1.0], [bucket id: 4, min: "35", max: "35", ndv: 1.0, count: 1.0]                           │
│ user_id     │              5 │ [bucket id: 0, min: "1", max: "1", ndv: 1.0, count: 1.0], [bucket id: 1, min: "2", max: "2", ndv: 1.0, count: 1.0], [bucket id: 2, min: "3", max: "3", ndv: 1.0, count: 1.0], [bucket id: 3, min: "4", max: "4", ndv: 1.0, count: 1.0], [bucket id: 4, min: "5", max: "5", ndv: 1.0, count: 1.0]                                     │
│ name        │              5 │ [bucket id: 0, min: "Alice", max: "Alice", ndv: 1.0, count: 1.0], [bucket id: 1, min: "Bob", max: "Bob", ndv: 1.0, count: 1.0], [bucket id: 2, min: "Charlie", max: "Charlie", ndv: 1.0, count: 1.0], [bucket id: 3, min: "Diana", max: "Diana", ndv: 1.0, count: 1.0], [bucket id: 4, min: "Eve", max: "Eve", ndv: 1.0, count: 1.0] │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

ANALYZE TABLE sample;

SELECT * FROM FUSE_STATISTIC('default', 'sample');
```

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ 列名        │ 不同值数量     │                                                                                                                                                                                                直方图                                                                                                                                                                                                │
├─────────────┼────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ name        │              6 │ [桶ID: 0, 最小值: "Alice", 最大值: "Alice", 不同值数量: 1.0, 计数: 1.0], [桶ID: 1, 最小值: "Bob", 最大值: "Bob", 不同值数量: 1.0, 计数: 1.0], [桶ID: 2, 最小值: "Charlie", 最大值: "Charlie", 不同值数量: 1.0, 计数: 1.0], [桶ID: 3, 最小值: "Diana", 最大值: "Diana", 不同值数量: 1.0, 计数: 1.0], [桶ID: 4, 最小值: "Eve", 最大值: "Eve", 不同值数量: 1.0, 计数: 1.0], [桶ID: 5, 最小值: "Frank", 最大值: "Frank", 不同值数量: 1.0, 计数: 1.0] │
│ age         │              5 │ [桶ID: 0, 最小值: "25", 最大值: "25", 不同值数量: 1.0, 计数: 1.0], [桶ID: 1, 最小值: "28", 最大值: "28", 不同值数量: 1.0, 计数: 1.0], [桶ID: 2, 最小值: "28", 最大值: "28", 不同值数量: 1.0, 计数: 1.0], [桶ID: 3, 最小值: "30", 最大值: "30", 不同值数量: 1.0, 计数: 1.0], [桶ID: 4, 最小值: "35", 最大值: "35", 不同值数量: 1.0, 计数: 1.0], [桶ID: 5, 最小值: "40", 最大值: "40", 不同值数量: 1.0, 计数: 1.0]                                 │
│ user_id     │              6 │ [桶ID: 0, 最小值: "1", 最大值: "1", 不同值数量: 1.0, 计数: 1.0], [桶ID: 1, 最小值: "2", 最大值: "2", 不同值数量: 1.0, 计数: 1.0], [桶ID: 2, 最小值: "3", 最大值: "3", 不同值数量: 1.0, 计数: 1.0], [桶ID: 3, 最小值: "4", 最大值: "4", 不同值数量: 1.0, 计数: 1.0], [桶ID: 4, 最小值: "5", 最大值: "5", 不同值数量: 1.0, 计数: 1.0], [桶ID: 5, 最小值: "6", 最大值: "6", 不同值数量: 1.0, 计数: 1.0]                                             │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```